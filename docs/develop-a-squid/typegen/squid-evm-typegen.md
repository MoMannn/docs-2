---
sidebar_position: 2
description: Reference page of the squid-evm-typegen command line tool
---

# Squid EVM typegen

**Since `@subsquid/evm-typegen@2.0.0`**

The `evm-typegen(1)` tool generates TypeScript facades for EVM transactions, logs and `eth_call` queries.

The generated facades are assumed to be used by squids indexing EVM data.

The ABI file can be specified in three ways:

- as a plain JSON file:

```bash
npx squid-evm-typegen src/abi erc20.json
```

- as a contract address (to fetch ABI from the Etherscan API). Once can pass multiple addresses at once.

```bash
npx squid-evm-typegen src/abi 0xBB9bc244D798123fDe783fCc1C72d3Bb8C189413
```

- as an arbitrary URL:
```bash
npx squid-evm-typegen src/abi https://example.com/erc721.json
```

In all cases typegen will use ABI's `basename` as the root name for the generated files. You can overwrite the basename of generated files using the fragment `(#)` suffix.

```bash
squid-evm-typegen src/abi 0xBB9bc244D798123fDe783fCc1C72d3Bb8C189413#contract   
```

**Arguments:**

|                        |                                                           |
|------------------------|-----------------------------------------------------------|
|  `output-dir`          | output directory for generated definitions                |
|  `abi`                 | A contract address, a URL or local path to the ABI file.  Accepts multipl|


**Options:**

|                           |                                                          |
|---------------------------|----------------------------------------------------------| 
|  `--multicall`            | generate a facade for MakerDAO multicall contract        |
|  `--etherscan-api <url>`  | etherscan API to fetch contract ABI by a known address. By default, `https://api.etherscan.io/`   |
|  `--clean`                | delete output directory before run                       |
|  `-h, --help`             | display help for command                                 |


## Usage 

### Events 

The EVM log data is provided by the `event` object with wrappers for each event defined in the ABI. 

**Example**

Subscribe to topics:

```ts
// generated by evm-typegen
import { events } from "./abi/weth";

const processor = new EvmBatchProcessor()
  .setDataSource({
    archive: 'https://eth.archive.subsquid.io',
  })
  .addLog([
    '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'
  ], {
    filter: [[
      events.Deposit.topic, events.Withdrawal.topic
    ]],
    data: {
      evmLog: {
          topics: true,
          data: true,
      },
    } as const,
  })
```

Decode event data:
```ts
processor.run(new TypeormDatabase(), async (ctx) => {
  for (let c of ctx.blocks) {
    for (let i of c.items) {
      if (i.kind === 'evmLog' && i.evmLog.topics[0] == events.Deposit.topic) {
        // type-safe decoding of the Deposit event data
        const amt = events.Deposit.decode(i.evmLog).wad
      }
    }
});
```

### Transactions

Similar to `events`, transaction access is provided by the `functions` object. Each contract method defined in the ABI. 

### Contract state calls

The typegen creates a wrapper contract classes for each contract Create a contract instance using the processor context and the block height at which the state should be queried.

**Example**

```ts
// generated by evm-typegen
import { Contract } from "./abi/weth";

processor.run(new TypeormDatabase(), async (ctx) => {
  for (let c of ctx.blocks) {
    for (let i of c.items) {
      // call totalSupply() at the current block
      let supply = await (new Contract(ctx, c, '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2').totalSupply())
    }
  }
});
```
